# DevOps Shared Data - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã —Å —Å—É–±–∞–≥–µ–Ω—Ç–æ–º **devops-shared-data** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è shared —Ä–µ—Å—É—Ä—Å–∞–º–∏ –≤ Kubernetes.

## üìç –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–∞–±–æ—Ç—ã

```bash
cd ~/projects/<project>/shared-data/stages/<namespace>/
claude
# –°—É–±–∞–≥–µ–Ω—Ç devops-shared-data –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
```

---

## üìù ConfigMaps

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π ConfigMap

**–ó–∞–ø—Ä–æ—Å:**
```
–î–æ–±–∞–≤—å –Ω–æ–≤—ã–π ConfigMap —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π nginx –¥–ª—è rate limiting
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –ß–∏—Ç–∞–µ—Ç —Ç–µ–∫—É—â–∏–π `values.yaml`
2. ‚ö†Ô∏è –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
3. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç:
   ```yaml
   configMaps:
     - name: nginx-rate-limit-config
       data:
         nginx.conf: |
           limit_req_zone $binary_remote_addr zone=limitzone:10m rate=10r/s;
           limit_req zone=limitzone burst=20 nodelay;
   ```
4. ‚úÖ `helmfile diff`
5. ‚ö†Ô∏è –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ `helmfile sync`
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ:
   ```bash
   kubectl get configmap nginx-rate-limit-config -n <namespace>
   kubectl describe configmap nginx-rate-limit-config -n <namespace>
   ```

### –ü—Ä–∏–º–µ—Ä 2: –ò–∑–º–µ–Ω–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ConfigMap

**–ó–∞–ø—Ä–æ—Å:**
```
–ò–∑–º–µ–Ω–∏ –≤ ConfigMap app-config –∑–Ω–∞—á–µ–Ω–∏–µ timeout —Å 30 –Ω–∞ 60
```

**‚ö†Ô∏è –í–ê–ñ–ù–û - –∞–≥–µ–Ω—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏!**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –ß–∏—Ç–∞–µ—Ç —Ç–µ–∫—É—â–∏–π values.yaml
2. ‚úÖ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∫–∏–µ –ø–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç ConfigMap:**
   ```bash
   kubectl get pods -n <namespace> -o yaml | grep -B 5 "app-config"
   ```
3. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–¥–æ–≤:
   ```
   –ù–∞–π–¥–µ–Ω–æ 5 –ø–æ–¥–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö ConfigMap 'app-config':
   - api-service-xxx
   - backend-worker-yyy
   - frontend-zzz
   - ...
   ```
4. ‚ö†Ô∏è –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ
5. ‚úÖ –û–±–Ω–æ–≤–ª—è–µ—Ç ConfigMap
6. ‚úÖ `helmfile diff`
7. ‚úÖ **–ü–†–ï–î–£–ü–†–ï–ñ–î–ê–ï–¢ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   ```
   ‚ö†Ô∏è ConfigMap –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 5 –ø–æ–¥–∞–º–∏.
   –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Ö –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
   –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏!
   ```
8. ‚ö†Ô∏è –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ sync
9. ‚ö†Ô∏è –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–¥—ã:
   ```
   –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å deployment-—ã?
   kubectl rollout restart deployment/api-service -n <namespace>
   kubectl rollout restart deployment/backend-worker -n <namespace>
   ...
   ```

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç ConfigMap

**–ó–∞–ø—Ä–æ—Å:**
```
–ü–æ–∫–∞–∂–∏ –∫–∞–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç ConfigMap app-config
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç (–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è):**
1. ‚úÖ –ò—â–µ—Ç pods:
   ```bash
   kubectl get pods -n <namespace> -o json | \
     jq '.items[] | select(.spec.volumes[]?.configMap.name=="app-config") | .metadata.name'
   ```
2. ‚úÖ –ò—â–µ—Ç deployments:
   ```bash
   kubectl get deployment -n <namespace> -o json | \
     jq '.items[] | select(.spec.template.spec.volumes[]?.configMap.name=="app-config") | .metadata.name'
   ```
3. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   ```
   ConfigMap 'app-config' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

   Pods:
   - api-service-7d8f9-abc
   - backend-worker-5f6g7-def
   - frontend-3e4r5-ghi

   Deployments:
   - api-service (2 replicas)
   - backend-worker (3 replicas)
   - frontend (5 replicas)

   –í—Å–µ–≥–æ –ø–æ–¥–æ–≤: 10
   ```
4. ‚úÖ –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç: "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —ç—Ç–æ–≥–æ ConfigMap –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ 10 –ø–æ–¥–æ–≤!"

---

## üîê ExternalSecrets

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞—Ç—å ExternalSecret –¥–ª—è PostgreSQL

**–ó–∞–ø—Ä–æ—Å:**
```
–°–æ–∑–¥–∞–π ExternalSecret –¥–ª—è PostgreSQL credentials –∏–∑ Vault path secrets/kuber/production/postgres
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –ß–∏—Ç–∞–µ—Ç values.yaml –∏–ª–∏ secret.values.yaml
2. ‚úÖ –û–±—ä—è—Å–Ω—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É Vault path –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ namespace
3. ‚úÖ **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞ –≤ Vault:**
   ```bash
   vault kv get -mount=secrets production/postgres
   ```
4. ‚ö†Ô∏è –ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–æ–∑–¥–∞—Ç—å:
   ```
   –°–µ–∫—Ä–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ Vault.
   –°–æ–∑–¥–∞—Ç—å —Å–µ–∫—Ä–µ—Ç —Å credentials? [—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è]

   vault kv put -mount=secrets production/postgres \
     username=postgres \
     password=<secure-password> \
     database=production_db
   ```
5. ‚ö†Ô∏è –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ values.yaml
6. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
   ```yaml
   externalSecrets:
     - name: postgres-credentials
       secretStoreRef: vault-backend
       data:
         - secretKey: POSTGRES_PASSWORD
           vault_path: production/postgres
           vaultKey: password
         - secretKey: POSTGRES_USER
           vault_path: production/postgres
           vaultKey: username
         - secretKey: POSTGRES_DB
           vault_path: production/postgres
           vaultKey: database
   ```
7. ‚úÖ `helmfile diff`
8. ‚ö†Ô∏è –ü—Ä–∏–º–µ–Ω—è–µ—Ç —á–µ—Ä–µ–∑ sync
9. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ:
   ```bash
   kubectl get externalsecret postgres-credentials -n <namespace>
   kubectl describe externalsecret postgres-credentials -n <namespace>
   kubectl get secret postgres-credentials -n <namespace>
   ```

### –ü—Ä–∏–º–µ—Ä 2: –î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π ExternalSecret

**–ó–∞–ø—Ä–æ—Å:**
```
–î–æ–±–∞–≤—å –≤ ExternalSecret app-secrets –∫–ª—é—á REDIS_URL
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –ß–∏—Ç–∞–µ—Ç values.yaml
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç vault path –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –µ—Å—Ç—å –ª–∏ –∫–ª—é—á –≤ Vault:
   ```bash
   vault kv get -mount=secrets production/app-secrets
   ```
4. ‚ö†Ô∏è –ï—Å–ª–∏ –Ω–µ—Ç - –¥–æ–±–∞–≤–ª—è–µ—Ç –≤ Vault:
   ```bash
   vault kv patch -mount=secrets production/app-secrets redis_url=redis://redis:6379
   ```
5. ‚ö†Ô∏è –û–±–Ω–æ–≤–ª—è–µ—Ç ExternalSecret –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
6. ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç

### –ü—Ä–∏–º–µ—Ä 3: –î–µ–±–∞–≥ ExternalSecret –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ó–∞–ø—Ä–æ—Å:**
```
–ü–æ—á–µ–º—É ExternalSecret database-creds –Ω–µ —Å–æ–∑–¥–∞–µ—Ç Secret?
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç (–≤—Å—ë –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è):**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å ExternalSecret:
   ```bash
   kubectl get externalsecret database-creds -n <namespace>
   kubectl describe externalsecret database-creds -n <namespace>
   ```
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–∑–¥–∞–Ω –ª–∏ Secret:
   ```bash
   kubectl get secret database-creds -n <namespace>
   ```
3. ‚úÖ –ò–∑–≤–ª–µ–∫–∞–µ—Ç vault_path –∏–∑ secret.values.yaml
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤ Vault:
   ```bash
   vault kv get -mount=secrets <vault_path>
   vault kv list -mount=secrets <path>
   ```
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç SecretStore:
   ```bash
   kubectl get secretstore -n <namespace>
   kubectl describe secretstore vault-backend -n <namespace>
   ```
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–æ–≥–∏ operator:
   ```bash
   kubectl logs -n external-secrets-system -l app.kubernetes.io/name=external-secrets --tail=100
   ```
7. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–±—ã—Ç–∏—è:
   ```bash
   kubectl get events -n <namespace> --field-selector involvedObject.name=database-creds
   ```
8. ‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ:
   ```
   –ü—Ä–æ–±–ª–µ–º–∞: SecretStore –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Vault
   –ü—Ä–∏—á–∏–Ω–∞: ServiceAccount –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —á—Ç–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞

   –†–µ—à–µ–Ω–∏–µ:
   1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Vault policy –¥–ª—è ServiceAccount
   2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Vault role binding
   3. –ò–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ vault_path –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
   ```

---

## üíæ PersistentVolumeClaims

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞—Ç—å PVC –¥–ª—è shared storage

**–ó–∞–ø—Ä–æ—Å:**
```
–°–æ–∑–¥–∞–π PVC –¥–ª—è shared —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Ä–∞–∑–º–µ—Ä–æ–º 10Gi —Å ReadWriteMany
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –ß–∏—Ç–∞–µ—Ç values.yaml
2. ‚ö†Ô∏è –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
3. ‚úÖ –î–æ–±–∞–≤–ª—è–µ—Ç:
   ```yaml
   persistentVolumeClaims:
     - name: shared-storage
       storageClassName: fast-ssd
       accessModes:
         - ReadWriteMany
       storage: 10Gi
   ```
4. ‚úÖ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   ```bash
   kubectl get pvc shared-storage -n <namespace>
   kubectl describe pvc shared-storage -n <namespace>
   ```
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç binding –∫ PV:
   ```bash
   kubectl get pv | grep shared-storage
   ```

### –ü—Ä–∏–º–µ—Ä 2: –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä PVC

**–ó–∞–ø—Ä–æ—Å:**
```
–£–≤–µ–ª–∏—á—å —Ä–∞–∑–º–µ—Ä PVC shared-storage –¥–æ 20Gi
```

**‚ö†Ô∏è –í–ê–ñ–ù–û - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ resize!**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç StorageClass –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ resize:
   ```bash
   kubectl get storageclass fast-ssd -o yaml | grep allowVolumeExpansion
   ```
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∫–∏–µ –ø–æ–¥—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç PVC
3. ‚ö†Ô∏è –ï—Å–ª–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ migration
4. ‚ö†Ô∏è –ï—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç - –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç –ø—Ä–æ—Ü–µ—Å—Å

### –ü—Ä–∏–º–µ—Ä 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PVC

**–ó–∞–ø—Ä–æ—Å:**
```
–ü–æ–∫–∞–∂–∏ –∫–∞–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç PVC shared-storage
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç (–±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è):**
1. ‚úÖ –ò—â–µ—Ç –ø–æ–¥—ã:
   ```bash
   kubectl get pods -n <namespace> -o json | \
     jq -r '.items[] | select(.spec.volumes[]?.persistentVolumeClaim.claimName == "shared-storage") | .metadata.name'
   ```
2. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫
3. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ:
   ```bash
   kubectl exec <pod> -n <namespace> -- df -h /mnt/shared
   ```

---

## üîÑ –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –ü—Ä–∏–º–µ—Ä 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å shared –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è microservices

**–ó–∞–ø—Ä–æ—Å:**
```
–°–æ–∑–¥–∞–π shared –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤:
- ConfigMap —Å –æ–±—â–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (API endpoints, timeouts)
- ExternalSecret –¥–ª—è shared credentials (Redis, RabbitMQ, PostgreSQL)
- PVC –¥–ª—è shared file storage
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å ConfigMap
2. ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç ExternalSecrets –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
3. ‚úÖ –°–æ–∑–¥–∞–µ—Ç PVC
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
5. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Ä–µ—Å—É—Ä—Å—ã

### –ü—Ä–∏–º–µ—Ä 2: –ú–∏–≥—Ä–∞—Ü–∏—è shared —Ä–µ—Å—É—Ä—Å–æ–≤ –º–µ–∂–¥—É namespace

**–ó–∞–ø—Ä–æ—Å:**
```
–ü–æ–º–æ–≥–∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å shared ConfigMaps –∏ Secrets –∏–∑ staging –≤ production
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –ß–∏—Ç–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ staging
2. ‚úÖ –°–æ–∑–¥–∞–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è production
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç vault paths –¥–ª—è production
4. ‚úÖ –°–æ–∑–¥–∞–µ—Ç —á–µ–∫–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
5. ‚úÖ –ü–æ–º–æ–≥–∞–µ—Ç —Å –∫–∞–∂–¥—ã–º —à–∞–≥–æ–º

---

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏

### –ü—Ä–∏–º–µ—Ä 1: –£–¥–∞–ª–∏—Ç—å ConfigMap

**–ó–∞–ø—Ä–æ—Å:**
```
–£–¥–∞–ª–∏ ConfigMap old-config
```

**‚ö†Ô∏è –°–£–ü–ï–† –í–ê–ñ–ù–û - –∞–≥–µ–Ω—Ç –æ—á–µ–Ω—å –æ—Å—Ç–æ—Ä–æ–∂–µ–Ω!**

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ **–°–ù–ê–ß–ê–õ–ê –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
   ```bash
   kubectl get pods -n <namespace> -o yaml | grep -B 5 "old-config"
   ```
2. ‚úÖ –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è - **–û–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–¢–°–Ø –∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç:**
   ```
   ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï! ‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è

   ConfigMap 'old-config' –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–æ–¥–∞–º–∏:
   - api-service-xxx
   - worker-yyy

   –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ü–ê–î–ï–ù–ò–Æ —ç—Ç–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π!

   –í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å?
   ```
3. ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–≥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
4. ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è - —É–¥–∞–ª—è–µ—Ç

### –ü—Ä–∏–º–µ—Ä 2: –ò–∑–º–µ–Ω–∏—Ç—å critical ConfigMap

**–ó–∞–ø—Ä–æ—Å:**
```
–ò–∑–º–µ–Ω–∏ ConfigMap database-config
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
2. ‚úÖ –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è production –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏ - **–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ:**
   ```
   ‚ö†Ô∏è –≠—Ç–æ—Ç ConfigMap –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è production –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏!

   –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
   1. –°–¥–µ–ª–∞—Ç—å backup —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
   3. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–µ—Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å –ø–æ–¥—ã (rolling restart)
   4. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞

   –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?
   ```

---

## üîç –ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ü—Ä–∏–º–µ—Ä 1: –ê—É–¥–∏—Ç shared —Ä–µ—Å—É—Ä—Å–æ–≤

**–ó–∞–ø—Ä–æ—Å:**
```
–ü—Ä–æ–≤–µ–¥–∏ –∞—É–¥–∏—Ç –≤—Å–µ—Ö shared —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ namespace production
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö ConfigMaps —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
2. ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö Secrets –∏ ExternalSecrets —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
3. ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö PVCs —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
4. ‚úÖ –í—ã—è–≤–ª—è–µ—Ç –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–µ—Å—É—Ä—Å—ã
5. ‚úÖ –í—ã—è–≤–ª—è–µ—Ç —Ä–µ—Å—É—Ä—Å—ã –±–µ–∑ backup
6. ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å Vault

**–ó–∞–ø—Ä–æ—Å:**
```
–ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –≤—Å–µ ExternalSecrets –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å Vault
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö ExternalSecrets
2. ‚úÖ –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
   - –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
   - –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤ Vault
   - –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ –í—ã—è–≤–ª—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã
4. ‚úÖ –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 3: –ü–æ–∫–∞–∑–∞—Ç—å dependency graph

**–ó–∞–ø—Ä–æ—Å:**
```
–ü–æ–∫–∞–∂–∏ –≥—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π shared —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ deployments
2. ‚úÖ –ù–∞—Ö–æ–¥–∏—Ç —Å–≤—è–∑–∏ —Å ConfigMaps, Secrets, PVCs
3. ‚úÖ –°–æ–∑–¥–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≥—Ä–∞—Ñ:
   ```
   ConfigMap 'app-config':
   ‚îú‚îÄ‚îÄ api-service (2 pods)
   ‚îú‚îÄ‚îÄ backend-worker (3 pods)
   ‚îî‚îÄ‚îÄ frontend (5 pods)

   ExternalSecret 'database-creds':
   ‚îú‚îÄ‚îÄ api-service (2 pods)
   ‚îî‚îÄ‚îÄ backend-worker (3 pods)

   PVC 'shared-storage':
   ‚îî‚îÄ‚îÄ fileserver (1 pod)
   ```

---

## üõ°Ô∏è Best Practices

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ best practices

**–ó–∞–ø—Ä–æ—Å:**
```
–ü—Ä–æ–≤–µ—Ä—å shared —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ best practices
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ ConfigMaps –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ (< 1MB)
2. ‚úÖ ExternalSecrets –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–æ plain Secrets
3. ‚úÖ SecretStore –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
4. ‚úÖ PVCs –∏–º–µ—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ StorageClass
5. ‚úÖ Naming conventions —Å–æ–±–ª—é–¥–µ–Ω—ã
6. ‚úÖ Labels –∏ annotations –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç
7. ‚úÖ –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 2: –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**–ó–∞–ø—Ä–æ—Å:**
```
–ü—Ä–µ–¥–ª–æ–∂–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è shared —Ä–µ—Å—É—Ä—Å–æ–≤
```

---

## üö® Troubleshooting

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å ConfigMap

**–ó–∞–ø—Ä–æ—Å:**
```
–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ api-service –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—á–∏—Ç–∞—Ç—å ConfigMap app-config
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–≥–µ–Ω—Ç:**
1. ‚úÖ ConfigMap —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
2. ‚úÖ ConfigMap –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º namespace
3. ‚úÖ Pod –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π volume mount
4. ‚úÖ RBAC –ø—Ä–∞–≤–∞ (ServiceAccount –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å ConfigMap)
5. ‚úÖ ConfigMap –Ω–µ corrupted
6. ‚úÖ –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ

### –ü—Ä–∏–º–µ—Ä 2: ExternalSecret –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ SecretSyncedError

**–ó–∞–ø—Ä–æ—Å:**
```
ExternalSecret app-secrets –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç SecretSyncedError
```

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤ –ø—Ä–∏–º–µ—Ä–µ 3 —Ä–∞–∑–¥–µ–ª–∞ ExternalSecrets**

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

### –ë—É–¥—å—Ç–µ –æ—Å–æ–±–µ–Ω–Ω–æ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã
Shared —Ä–µ—Å—É—Ä—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è **–º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–µ—é—Ç —à–∏—Ä–æ–∫–∏–π impact!

### –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
–ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º/—É–¥–∞–ª–µ–Ω–∏–µ–º **–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ** –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ—Å—É—Ä—Å

### ConfigMap/Secret –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç—Ä–µ–±—É—é—Ç restart
Kubernetes **–Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç** –ø–æ–¥—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ ConfigMap/Secret

### Vault paths
–ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ vault_path: `<project>/<namespace>/<service>`

### Monitoring
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–ª—è ExternalSecrets sync status

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-11-21
